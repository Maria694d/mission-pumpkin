<!doctype html><html lang="de"><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
<title>Station 3 ‚Äì Fl√ºsterr√§tsel</title>

<style>
  :root{
    --ink:#eef2ff; --muted:#aab1c2; --edge:#2b2f45;
    --accent:#ff9d3b; --accent2:#ffb454; --cardbg:rgba(12,13,22,.86);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; color:var(--ink);
    font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;
    background:#0a0a0f; line-height:1.6;
  }
  .bg{position:fixed; inset:0; z-index:0; background-position:center; background-size:cover; background-repeat:no-repeat; filter:brightness(.85) contrast(1.06)}
  .fog,.fog:before,.fog:after{position:fixed; inset:-20%; z-index:1; pointer-events:none; filter:blur(14px);
    background:radial-gradient(60% 50% at 50% 50%, rgba(200,200,255,.07), rgba(200,200,255,0) 60%);
    animation:fog 75s linear infinite; opacity:.28}
  .fog:before{content:""; animation-duration:100s; animation-direction:reverse; opacity:.22}
  .fog:after{content:""; animation-duration:120s; opacity:.18}
  @keyframes fog{0%{transform:translate3d(-10%,-6%,0) scale(1.05)}50%{transform:translate3d(12%,8%,0) scale(1.1)}100%{transform:translate3d(-10%,-6%,0) scale(1.05)}}
  .wrap{position:relative; z-index:2; min-height:100%; display:flex; align-items:center; justify-content:center; padding:22px}
  .card{width:min(980px,96vw); background:var(--cardbg); border:1px solid var(--edge); border-radius:18px;
    box-shadow:0 18px 44px rgba(0,0,0,.55), inset 0 0 0 1px rgba(255,255,255,.03); padding:22px}
  h1{margin:0 0 8px; font-size:30px; text-shadow:0 0 18px rgba(255,157,59,.18)}
  h2{margin:16px 0 6px; font-size:20px; color:var(--accent2)}
  p{font-size:18px; margin:10px 0}
  .divider{height:10px; margin:10px 0 14px; background:
    radial-gradient(12px 8px at 12px 4px,rgba(255,180,84,.85),rgba(255,180,84,0) 55%),
    linear-gradient(to right, rgba(255,157,59,.45), rgba(255,157,59,0) 40%);
    filter:drop-shadow(0 0 8px rgba(255,157,59,.25))}
  .row{display:flex; gap:10px; flex-wrap:wrap; align-items:center; margin-top:12px; justify-content:center}
  .btn{
    display:inline-block; padding:12px 18px; border-radius:14px; text-decoration:none; font-weight:900; letter-spacing:.3px;
    color:#111; background:radial-gradient(120% 120% at 30% 30%, var(--accent2), var(--accent));
    box-shadow:0 10px 28px rgba(0,0,0,.6); filter:drop-shadow(0 0 12px rgba(255,157,59,.35))
  }
  .pulse{position:relative}
  .pulse:before{content:""; position:absolute; inset:-4px; border-radius:16px; box-shadow:0 0 20px rgba(255,157,59,.55); animation:pulse 1.6s ease-in-out infinite; opacity:.8}
  @keyframes pulse{0%{transform:scale(.97)}50%{transform:scale(1.02)}100%{transform:scale(.97)}}
  input[type=text]{width:100%; max-width:420px; background:#0f0f18; border:1px solid #33364a; color:#e9edf5; border-radius:10px; padding:10px 12px; font-size:18px}
  .msg{margin-top:10px; padding:12px; border-radius:12px; display:none}
  .ok{background:#12351a; border:1px solid #2b7a3f; color:#b6f2c6}
  .bad{background:#3a1b1b; border:1px solid #7a2b2b; color:#ffc0c0}
  .footer{margin-top:12px; color:var(--muted); font-size:12px}
  .gate{position:fixed; inset:0; background:rgba(6,6,10,.86); display:none; place-items:center; z-index:5; text-align:center; padding:20px}
  .gate .inner{background:#151626; border:1px solid #2b2f45; padding:18px 20px; border-radius:14px; max-width:520px; box-shadow:0 18px 40px rgba(0,0,0,.6)}
</style>

<body>
  <div class="bg" style="background-image: url('./img/st3.jpg'), url('data:image/svg+xml;utf8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%221600%22%20height%3D%221000%22%3E%0A%20%20%3Cdefs%3E%0A%20%20%20%20%3ClinearGradient%20id%3D%22g%22%20x1%3D%220%22%20y1%3D%220%22%20x2%3D%220%22%20y2%3D%221%22%3E%0A%20%20%20%20%20%20%3Cstop%20offset%3D%220%25%22%20stop-color%3D%22%2312162b%22/%3E%0A%20%20%20%20%20%20%3Cstop%20offset%3D%2270%25%22%20stop-color%3D%22%230a0c16%22/%3E%0A%20%20%20%20%20%20%3Cstop%20offset%3D%22100%25%22%20stop-color%3D%22%2307080d%22/%3E%0A%20%20%20%20%3C/linearGradient%3E%0A%20%20%20%20%3CradialGradient%20id%3D%22m%22%20cx%3D%2278%25%22%20cy%3D%2214%25%22%3E%0A%20%20%20%20%20%20%3Cstop%20offset%3D%220%25%22%20stop-color%3D%22%23f6f3d6%22/%3E%0A%20%20%20%20%20%20%3Cstop%20offset%3D%22100%25%22%20stop-color%3D%22%23c0bfa2%22%20stop-opacity%3D%220.2%22/%3E%0A%20%20%20%20%3C/radialGradient%3E%0A%20%20%20%20%3Cfilter%20id%3D%22blur%22%3E%3CfeGaussianBlur%20stdDeviation%3D%221.2%22/%3E%3C/filter%3E%0A%20%20%3C/defs%3E%0A%20%20%3Crect%20width%3D%22100%25%22%20height%3D%22100%25%22%20fill%3D%22url%28%23g%29%22/%3E%0A%20%20%3Ccircle%20cx%3D%221280%22%20cy%3D%22180%22%20r%3D%2290%22%20fill%3D%22url%28%23m%29%22/%3E%0A%20%20%3Cg%20fill%3D%22%230b0e1a%22%20opacity%3D%220.9%22%3E%0A%20%20%20%20%3Crect%20y%3D%22900%22%20width%3D%221600%22%20height%3D%22120%22/%3E%0A%20%20%20%20%3Cpath%20d%3D%22M0%2C930%20C200%2C900%20280%2C950%20420%2C930%20C560%2C910%20660%2C950%20820%2C930%20C980%2C910%201120%2C950%201280%2C930%20C1440%2C910%201520%2C950%201600%2C930%20L1600%2C1000%20L0%2C1000%20Z%22%20fill%3D%22%230a0c18%22/%3E%0A%20%20%3C/g%3E%0A%20%20%3Cg%20fill%3D%22%230d1222%22%20opacity%3D%220.55%22%20filter%3D%22url%28%23blur%29%22%3E%0A%20%20%20%20%3Crect%20x%3D%22120%22%20y%3D%22840%22%20width%3D%2212%22%20height%3D%2280%22/%3E%0A%20%20%20%20%3Crect%20x%3D%22140%22%20y%3D%22820%22%20width%3D%2210%22%20height%3D%22100%22/%3E%0A%20%20%20%20%3Crect%20x%3D%22155%22%20y%3D%22855%22%20width%3D%228%22%20height%3D%2265%22/%3E%0A%20%20%20%20%3Crect%20x%3D%22980%22%20y%3D%22830%22%20width%3D%2212%22%20height%3D%2290%22/%3E%0A%20%20%20%20%3Crect%20x%3D%221000%22%20y%3D%22850%22%20width%3D%2210%22%20height%3D%2270%22/%3E%0A%20%20%3C/g%3E%0A%20%20%3Ctext%20x%3D%2236%22%20y%3D%2280%22%20font-size%3D%2236%22%20font-family%3D%22Segoe%20UI%2C%20Arial%22%20fill%3D%22%23ff9d3b%22%20opacity%3D%220.88%22%3EStation%203%20%E2%80%93%20Fl%C3%BCsterr%C3%A4tsel%3C/text%3E%0A%3C/svg%3E')"></div>
  <div class="fog"></div>
  <div id="gate" class="gate"><div class="inner">
    <h3>üîä Tippe einmal, um die Atmosph√§re zu starten</h3>
    <p>Die Stimme startet nach wenigen Sekunden automatisch.</p>
    <p><a id="unlockBtn" class="btn pulse">Sound aktivieren</a></p>
  </div></div>
  <div class="wrap"><div class="card">
    <h1>Station 3 ‚Äì Fl√ºsterr√§tsel</h1>
    <div class="divider"></div>
    <h2>Aufgabe</h2>
    <p>Fl√ºstert ein Wort reihum von Ohr zu Ohr. Am Ende sagt die letzte Person laut, was angekommen ist.</p>
    
    <div class="row">
      <a class='btn' href='./station2.html'>‚Üê Zur√ºck</a> <a class='btn' href='./station4.html'>Weiter ‚Üí</a> <a class="btn" href="./index.html">‚ü≤ Start</a>
    </div>
    <div class="footer">Atmosph√§re l√§uft vorab, die Stimme startet nach wenigen Sekunden automatisch.</div>
  </div></div>
  <audio id="voice" src="./station3.mp3" preload="auto"></audio>
  
<script>
let AC = window.AudioContext || window.webkitAudioContext;
let actx;
function ensureCtx(){ if(!actx){ actx = new AC(); } if(actx.state==='suspended'){ return actx.resume(); } return Promise.resolve(); }
function unlocked(){ return localStorage.getItem('mp_audio_ready')==='1'; }
function setUnlocked(){ localStorage.setItem('mp_audio_ready','1'); }

// hall
function makeHall(node){
  const dry = actx.createGain(); dry.gain.value = 0.92;
  const wet = actx.createGain(); wet.gain.value = 0.28;
  const delay = actx.createDelay(); delay.delayTime.value = 0.22;
  const fb = actx.createGain(); fb.gain.value = 0.34;
  node.connect(dry);
  node.connect(delay);
  delay.connect(fb).connect(delay);
  delay.connect(wet);
  const out = actx.createGain();
  dry.connect(out); wet.connect(out);
  return out;
}

// layers
function makeWind(level=0.12){
  const n = actx.createBufferSource();
  const len = actx.sampleRate * 3;
  const buf = actx.createBuffer(1, len, actx.sampleRate);
  const data = buf.getChannelData(0);
  for(let i=0;i<len;i++){ data[i] = (Math.random()*2-1)*0.45; }
  n.buffer = buf; n.loop = true;
  const lp = actx.createBiquadFilter(); lp.type='lowpass'; lp.frequency.value = 700;
  const g = actx.createGain(); g.gain.value = level;
  n.connect(lp).connect(g);
  return {src:n, out:g};
}
function makeRumble(level=0.06){
  const osc = actx.createOscillator(); osc.type='sine'; osc.frequency.value = 48;
  const g = actx.createGain(); g.gain.value = level;
  osc.connect(g);
  return {src:osc, out:g};
}
function makeChimes(level=0.08){
  const o1 = actx.createOscillator(); o1.type='triangle'; o1.frequency.value=880;
  const o2 = actx.createOscillator(); o2.type='triangle'; o2.frequency.value=1318;
  const g = actx.createGain(); g.gain.value = 0.0;
  const now = actx.currentTime;
  g.gain.setValueAtTime(0, now);
  g.gain.linearRampToValueAtTime(level, now+1.2);
  g.gain.exponentialRampToValueAtTime(0.0001, now+6.0);
  setTimeout(()=>{ g.gain.value = 0; }, 6200);
  o1.connect(g); o2.connect(g);
  return {src:[o1,o2], out:g};
}
function stationLayers(idx){
  if(idx===0){ return ['wind','chimes']; } // intro/start
  if(idx===1){ return ['wind','rumble']; }
  if(idx===2){ return ['wind']; }
  if(idx===3){ return ['wind','chimes']; }
  if(idx===4){ return ['wind','rumble']; }
  if(idx===5){ return ['wind','rumble']; }
  if(idx===6){ return ['wind']; }
  if(idx===7){ return ['wind']; }
  if(idx===8){ return ['wind','chimes']; }
  return ['wind'];
}

function playScene(audioId, idx, prerollSec){
  ensureCtx().then(()=>{
    setUnlocked();
    const el = document.getElementById(audioId);
    el.pause(); el.currentTime = 0;

    const mediaNode = actx.createMediaElementSource(el);
    const hall = makeHall(mediaNode);
    hall.connect(actx.destination);

    const layers = stationLayers(idx);
    const bgNodes = [];
    layers.forEach(L=>{
      let node;
      if(L==='wind'){ node = makeWind(0.12); }
      else if(L==='rumble'){ node = makeRumble(0.06); }
      else if(L==='chimes'){ node = makeChimes(0.08); }
      if(!node) return;
      const wet = makeHall(node.out);
      wet.connect(actx.destination);
      if(Array.isArray(node.src)){ node.src.forEach(s=>s.start()); }
      else{ node.src.start(); }
      bgNodes.push(node);
    });

    const delayMs = Math.max(0,(prerollSec??0))*1000;
    setTimeout(()=>{ el.play().catch(()=>{}); }, delayMs);

    el.onended = ()=>{
      bgNodes.forEach(node=>{
        try{
          if(Array.isArray(node.src)){ node.src.forEach(s=>s.stop()); }
          else{ node.src.stop(); }
        }catch(e){}
      });
    };
  });
}

function setupGate(audioId, idx, prerollSec){
  const gate = document.getElementById('gate');
  if(unlocked()){ playScene(audioId, idx, prerollSec); return; }
  gate.style.display='grid';
  document.getElementById('unlockBtn').onclick = ()=>{
    playScene(audioId, idx, prerollSec);
    gate.style.display='none';
  };
  document.addEventListener('pointerdown', ()=>{
    if(gate.style.display!=='none'){ playScene(audioId, idx, prerollSec); gate.style.display='none'; }
  }, {once:true});
}
</script>

  <script>setupGate('voice', 3, 8);</script>
</body></html>
